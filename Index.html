<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>MegaBoxplus WebTV</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body, html {
      margin: 0; padding: 0;
      font-family: Arial, sans-serif;
      background: #0c1f3d;
      color: #fff;
      height: 100%;
    }
    #login, #app {
      display: none;
      height: 100vh;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    #login.active, #app.active {
      display: flex;
    }
    input, button {
      margin: 5px;
      padding: 10px;
      font-size: 16px;
    }
    #canalList {
      height: 300px;
      overflow-y: auto;
      width: 90%;
      max-width: 600px;
      background: #142e54;
      padding: 10px;
      border-radius: 10px;
    }
    .canal {
      margin: 5px 0;
      padding: 5px;
      background: #1a3b6e;
      border-radius: 5px;
      cursor: pointer;
    }
    video {
      width: 90%;
      max-width: 800px;
      margin-top: 10px;
      border: 2px solid #3da1ff;
      border-radius: 10px;
    }
    #search {
      margin: 10px 0;
      width: 80%;
      max-width: 400px;
      padding: 10px;
    }
  </style>
</head>
<body>

<div id="login" class="active">
  <h2>MegaBoxplus</h2>
  <input type="text" id="user" placeholder="Usuário">
  <input type="password" id="pass" placeholder="Senha">
  <button onclick="login()">Entrar</button>
</div>

<div id="app">
  <h3>Bem-vindo ao MegaBoxplus</h3>
  <input type="text" id="search" placeholder="Buscar canal..." oninput="filtrarCanais()">
  <div id="canalList"></div>
  <video id="player" controls autoplay></video>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
  const listaURL = "https://www.dropbox.com/scl/fi/2qrnsck786xi5i7wvhmie/minha-lista.txt?rlkey=795xgcvmzfwtfss81rpi6w3k9&st=ajmh5d8u&dl=1";

  const login = () => {
    const u = document.getElementById('user').value;
    const p = document.getElementById('pass').value;
    if (u === 'megabox' && p === 'plus123') {
      document.getElementById('login').classList.remove('active');
      document.getElementById('app').classList.add('active');
      carregarLista();
    } else {
      alert("Usuário ou senha inválidos!");
    }
  }

  let canais = [];

  async function carregarLista() {
    try {
      const res = await fetch(listaURL);
      const txt = await res.text();
      const linhas = txt.split('\n');
      for (let i = 0; i < linhas.length; i++) {
        if (linhas[i].startsWith('#EXTINF')) {
          const nome = linhas[i].split(',')[1]?.trim();
          const url = linhas[i + 1]?.trim();
          canais.push({ nome, url });
        }
      }
      mostrarCanais(canais);
    } catch (e) {
      alert("Erro ao carregar lista.");
    }
  }

  function mostrarCanais(lista) {
    const cont = document.getElementById('canalList');
    cont.innerHTML = '';
    lista.forEach(c => {
      const div = document.createElement('div');
      div.className = 'canal';
      div.innerText = c.nome;
      div.onclick = () => tocar(c.url);
      cont.appendChild(div);
    });
  }

  function filtrarCanais() {
    const termo = document.getElementById('search').value.toLowerCase();
    const filtrados = canais.filter(c => c.nome.toLowerCase().includes(termo));
    mostrarCanais(filtrados);
  }

  function tocar(url) {
    const video = document.getElementById('player');
    if (Hls.isSupported()) {
      const hls = new Hls();
      hls.loadSource(url);
      hls.attachMedia(video);
    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
      video.src = url;
    } else {
      alert("Seu navegador não suporta HLS.");
    }
  }
</script>
</body>
</html>
